<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>ë¡œê·¸ì¸</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/layout/nav.css">
    <link rel="stylesheet" href="/css/member/login.css">
</head>

<body>

<main>
<!--    <form class="login-container" action="/member/login" method="POST">-->
    <form class="login-container">
        <h2><a href="/item/list" >Shopping Mall</a></h2>

        <input id="username" name="username" placeholder="ì•„ì´ë””" required>
        <input id="password" name="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>


        <p id="error_msg" style="color: red; display: none;"></p>


        <!-- JWT ë°©ì‹ ë¡œê·¸ì¸ -->
        <button onclick="loginJWT(event)">ë¡œê·¸ì¸</button>

<!--        <button id="loginBtn" type="submit" disabled>ë¡œê·¸ì¸</button>-->

        <!-- âœ… íšŒì›ê°€ì… ìœ ë„ ë¬¸êµ¬ -->
        <p class="signup-link"> âœ‹ğŸ» ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="/member/signup">íšŒì›ê°€ì…</a></p>
    </form>


   <script>
  function loginJWT(event){
      event.preventDefault(); // í¼ ìƒˆë¡œê³ ì¹¨ ë°©ì§€

      fetch('/member/login/jwt', {
        method : 'POST',
        headers : {'Content-Type': 'application/json'},
        credentials: 'include',
        body : JSON.stringify({
          username : document.querySelector('#username').value,
          password : document.querySelector('#password').value
        }),
      })
      .then(r => r.json())
      .then(data => {
          console.log("ì„œë²„ ì‘ë‹µ:", data); // ë¨¼ì € ì‘ë‹µ êµ¬ì¡° í™•ì¸
          if (data.status === "success") {
            window.location.href = data.redirect;
          } else {
                document.querySelector('#error_msg').innerText = "ì•„ì´ë””(ë¡œê·¸ì¸ ì „í™”ë²ˆí˜¸, ë¡œê·¸ì¸ ì „ìš© ì•„ì´ë””) ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª» ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.\n";
                document.querySelector('#error_msg').style.display = 'block';
          }
        });
  }
</script>
</main>


<script src="/js/member/login.js"></script>

</body>
</html>
